<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>前端调试页面</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>前端调试页面</h1>
    <div id="status">正在检查...</div>
    <div id="errors"></div>

    <script>
        let statusDiv = document.getElementById('status');
        let errorsDiv = document.getElementById('errors');

        // 捕获所有JavaScript错误
        window.onerror = function(msg, url, line, col, error) {
            console.error('全局错误:', msg, error);
            errorsDiv.innerHTML += `<div class="error">JavaScript错误: ${msg} at ${url}:${line}:${col}</div>`;
            return true;
        };

        window.addEventListener('unhandledrejection', function(event) {
            console.error('未处理的Promise拒绝:', event.reason);
            errorsDiv.innerHTML += `<div class="error">Promise错误: ${event.reason}</div>`;
        });

        // 检查必要的依赖
        function checkDependencies() {
            let checks = [];

            // 检查React
            try {
                import('./src/main.tsx').then(module => {
                    console.log('React模块加载成功');
                    statusDiv.innerHTML += '<div class="success">✓ React模块可以正常导入</div>';

                    // 尝试渲染React应用
                    try {
                        // 这里我们手动渲染React应用来捕获错误
                        let script = document.createElement('script');
                        script.type = 'module';
                        script.textContent = `
                            import React from 'react';
                            import ReactDOM from 'react-dom/client';
                            import { ConfigProvider } from 'antd';
                            import zhCN from 'antd/locale/zh_CN';
                            import App from './src/App.tsx';
                            import './src/index.css';

                            console.log('开始渲染React应用...');

                            class ErrorBoundary extends React.Component {
                                constructor(props) {
                                    super(props);
                                    this.state = { hasError: false, error: null };
                                }

                                static getDerivedStateFromError(error) {
                                    return { hasError: true };
                                }

                                componentDidCatch(error, errorInfo) {
                                    this.setState({ error: error });
                                    console.error('React渲染错误:', error, errorInfo);
                                    document.getElementById('errors').innerHTML +=
                                        '<div class="error">React渲染错误: ' + error.toString() + '</div>';
                                }

                                render() {
                                    if (this.state.hasError) {
                                        return React.createElement('div', {style: {padding: 20, color: 'red'}},
                                            'React应用渲染失败: ' + this.state.error.toString()
                                        );
                                    }
                                    return this.props.children;
                                }
                            }

                            try {
                                ReactDOM.createRoot(document.getElementById('root')).render(
                                    React.createElement(React.StrictMode, null,
                                        React.createElement(ErrorBoundary, null,
                                            React.createElement(ConfigProvider, {locale: zhCN},
                                                React.createElement(App)
                                            )
                                        )
                                    )
                                );
                                console.log('React应用渲染完成');
                                document.getElementById('status').innerHTML +=
                                    '<div class="success">✓ React应用渲染成功</div>';
                            } catch (error) {
                                console.error('React渲染异常:', error);
                                document.getElementById('errors').innerHTML +=
                                    '<div class="error">React渲染异常: ' + error.message + '</div>';
                            }
                        `;
                        document.head.appendChild(script);

                    } catch (error) {
                        console.error('React渲染失败:', error);
                        errorsDiv.innerHTML += `<div class="error">React渲染失败: ${error.message}</div>`;
                    }

                }).catch(error => {
                    console.error('React模块加载失败:', error);
                    statusDiv.innerHTML += `<div class="error">✗ React模块加载失败: ${error.message}</div>`;
                });
            } catch (error) {
                statusDiv.innerHTML += `<div class="error">✗ 检查React时出错: ${error.message}</div>`;
            }
        }

        // 开始检查
        statusDiv.innerHTML = '<div class="info">开始检查前端环境...</div>';

        // 检查基础环境
        if (window.React) {
            statusDiv.innerHTML += '<div class="success">✓ React已加载</div>';
        } else {
            statusDiv.innerHTML += '<div class="info">⚗ React正在加载...</div>';
        }

        if (window.antd) {
            statusDiv.innerHTML += '<div class="success">✓ Ant Design已加载</div>';
        } else {
            statusDiv.innerHTML += '<div class="info">⚗ Ant Design正在加载...</div>';
        }

        // 添加React根节点
        let rootDiv = document.createElement('div');
        rootDiv.id = 'root';
        rootDiv.style.cssText = 'border: 1px solid #ddd; padding: 20px; margin: 20px 0;';
        rootDiv.innerHTML = '<div style="color: #666;">React应用将在这里渲染...</div>';
        document.body.appendChild(rootDiv);

        // 延迟检查依赖，给模块加载时间
        setTimeout(checkDependencies, 1000);
    </script>
</body>
</html>
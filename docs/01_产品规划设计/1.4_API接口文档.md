# 金融售前方案辅助编写系统 - API接口文档

## 文档信息

| 项目 | 内容 |
|------|------|
| 文档名称 | API接口文档 |
| 产品名称 | 金融售前方案辅助编写系统 |
| 版本 | v1.2.0 |
| 发布日期 | 2025-01-08 |
| 作者 | 开发团队 |
| 状态 | 正式发布 |
| 目标读者 | 前端开发、第三方集成、测试团队 |

## 版本历史

| 版本 | 日期 | 修改人 | 修改内容 |
|------|------|--------|----------|
| v1.0.0 | 2024-12-01 | 开发团队 | 初始版本创建 |
| v1.1.0 | 2024-12-15 | 开发团队 | 增加AI服务接口 |
| v1.2.0 | 2025-01-08 | 开发团队 | 完善WebSocket接口 |

## 1. API概述

### 1.1 接口规范

#### 1.1.1 基本规范
- **协议**: HTTPS
- **格式**: JSON
- **编码**: UTF-8
- **版本**: v1
- **Base URL**: `https://api.fin-pre-assist.com/v1`

#### 1.1.2 通用约定
```
✅ 成功响应格式:
{
    "code": 0,
    "message": "success",
    "data": { ... },
    "timestamp": "2024-01-08T12:00:00Z"
}

❌ 错误响应格式:
{
    "code": 40001,
    "message": "Invalid parameter",
    "details": {
        "field": "email",
        "reason": "Invalid email format"
    },
    "timestamp": "2024-01-08T12:00:00Z"
}
```

#### 1.1.3 状态码说明
| HTTP状态码 | 业务码 | 说明 |
|------------|--------|------|
| 200 | 0 | 请求成功 |
| 201 | 0 | 创建成功 |
| 400 | 400xx | 请求参数错误 |
| 401 | 401xx | 未授权访问 |
| 403 | 403xx | 权限不足 |
| 404 | 404xx | 资源不存在 |
| 409 | 409xx | 资源冲突 |
| 422 | 422xx | 业务逻辑错误 |
| 429 | 429xx | 请求频率限制 |
| 500 | 500xx | 服务器内部错误 |
| 503 | 503xx | 服务不可用 |

### 1.2 认证授权

#### 1.2.1 JWT Token认证
```http
POST /auth/login
Content-Type: application/json

{
    "username": "user@example.com",
    "password": "password123",
    "remember_me": true
}
```

**成功响应**:
```json
{
    "code": 0,
    "message": "Login successful",
    "data": {
        "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
        "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
        "token_type": "Bearer",
        "expires_in": 3600,
        "user": {
            "id": "550e8400-e29b-41d4-a716-446655440000",
            "username": "user@example.com",
            "full_name": "张三",
            "role": "editor"
        }
    },
    "timestamp": "2024-01-08T12:00:00Z"
}
```

#### 1.2.2 API Key认证
```http
GET /api/v1/documents
Authorization: Bearer {access_token}
X-API-Key: your-api-key-here
```

#### 1.2.3 权限说明
| 权限标识 | 说明 |
|----------|------|
| document:read | 读取文档 |
| document:write | 创建/修改文档 |
| document:delete | 删除文档 |
| template:read | 读取模板 |
| template:write | 创建/修改模板 |
| knowledge:read | 读取知识库 |
| knowledge:write | 创建/修改知识库 |
| admin:* | 管理员权限 |

### 1.3 通用参数

#### 1.3.1 分页参数
```http
GET /api/v1/documents?page=1&page_size=20&sort=created_at&order=desc
```

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| page | integer | 否 | 页码，默认1 |
| page_size | integer | 否 | 每页条数，默认20，最大100 |
| sort | string | 否 | 排序字段 |
| order | string | 否 | 排序方向：asc/desc |

#### 1.3.2 过滤参数
```http
GET /api/v1/documents?status=published&category=finance&tags=ai,ml&created_after=2024-01-01
```

#### 1.3.3 通用响应头
```http
X-Request-ID: 550e8400-e29b-41d4-a716-446655440000
X-RateLimit-Limit: 1000
X-RateLimit-Remaining: 999
X-RateLimit-Reset: 1641600000
```

## 2. 用户管理接口

### 2.1 用户认证

#### 2.1.1 用户登录
```http
POST /auth/login
```

**请求参数**:
```json
{
    "username": "user@example.com",  // 用户名或邮箱
    "password": "password123",       // 密码
    "remember_me": true,             // 记住我
    "captcha_token": "captcha_123"   // 验证码token（可选）
}
```

**响应参数**:
```json
{
    "code": 0,
    "data": {
        "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
        "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
        "token_type": "Bearer",
        "expires_in": 3600,
        "user": {
            "id": "550e8400-e29b-41d4-a716-446655440000",
            "username": "user@example.com",
            "full_name": "张三",
            "department": "技术部",
            "position": "高级工程师",
            "role": "editor",
            "avatar_url": "https://example.com/avatar.jpg",
            "permissions": ["document:read", "document:write", "template:read"]
        }
    }
}
```

**错误码**:
- `40101`: 用户名或密码错误
- `40102`: 账户被锁定
- `40103`: 需要验证码

#### 2.1.2 Token刷新
```http
POST /auth/refresh
```

**请求头**:
```http
Authorization: Bearer {refresh_token}
```

**响应参数**:
```json
{
    "code": 0,
    "data": {
        "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
        "token_type": "Bearer",
        "expires_in": 3600
    }
}
```

#### 2.1.3 用户登出
```http
POST /auth/logout
```

**请求头**:
```http
Authorization: Bearer {access_token}
```

**响应参数**:
```json
{
    "code": 0,
    "message": "Logout successful"
}
```

### 2.2 用户管理

#### 2.2.1 获取用户信息
```http
GET /users/profile
```

**响应参数**:
```json
{
    "code": 0,
    "data": {
        "id": "550e8400-e29b-41d4-a716-446655440000",
        "username": "user@example.com",
        "email": "user@example.com",
        "full_name": "张三",
        "department": "技术部",
        "position": "高级工程师",
        "phone": "+86-138-0000-0000",
        "avatar_url": "https://example.com/avatar.jpg",
        "role": "editor",
        "status": "active",
        "settings": {
            "language": "zh-CN",
            "theme": "light",
            "notifications": {
                "email": true,
                "push": false
            }
        },
        "statistics": {
            "document_count": 42,
            "template_count": 5,
            "knowledge_contributions": 18
        },
        "created_at": "2023-12-01T08:00:00Z",
        "updated_at": "2024-01-08T10:30:00Z"
    }
}
```

#### 2.2.2 更新用户信息
```http
PUT /users/profile
```

**请求参数**:
```json
{
    "full_name": "张三",
    "department": "技术部",
    "position": "高级工程师",
    "phone": "+86-138-0000-0000",
    "settings": {
        "language": "zh-CN",
        "theme": "dark",
        "notifications": {
            "email": true,
            "push": true
        }
    }
}
```

#### 2.2.3 修改密码
```http
PUT /users/password
```

**请求参数**:
```json
{
    "current_password": "old_password123",
    "new_password": "new_password456",
    "confirm_password": "new_password456"
}
```

### 2.3 用户列表管理（管理员）

#### 2.3.1 获取用户列表
```http
GET /admin/users?page=1&page_size=20&role=editor&status=active&search=zhang
```

**响应参数**:
```json
{
    "code": 0,
    "data": {
        "items": [
            {
                "id": "550e8400-e29b-41d4-a716-446655440000",
                "username": "user1@example.com",
                "full_name": "张三",
                "department": "技术部",
                "role": "editor",
                "status": "active",
                "last_login_at": "2024-01-08T09:30:00Z",
                "created_at": "2023-12-01T08:00:00Z"
            }
        ],
        "total": 150,
        "page": 1,
        "page_size": 20,
        "total_pages": 8
    }
}
```

#### 2.3.2 创建用户
```http
POST /admin/users
```

**请求参数**:
```json
{
    "username": "newuser@example.com",
    "email": "newuser@example.com",
    "password": "TempPassword123!",
    "full_name": "新用户",
    "department": "市场部",
    "role": "viewer",
    "send_welcome_email": true
}
```

#### 2.3.3 更新用户状态
```http
PUT /admin/users/{user_id}/status
```

**请求参数**:
```json
{
    "status": "suspended",
    "reason": "Security violation",
    "suspend_until": "2024-02-08T00:00:00Z"
}
```

## 3. 文档管理接口

### 3.1 文档CRUD操作

#### 3.1.1 获取文档列表
```http
GET /documents?page=1&page_size=20&status=published&author_id={user_id}&sort=created_at&order=desc
```

**查询参数**:
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| status | string | 否 | 文档状态：draft/published/archived |
| author_id | string | 否 | 作者ID |
| category | string | 否 | 文档分类 |
| tags | string | 否 | 标签，逗号分隔 |
| search | string | 否 | 搜索关键词 |
| created_after | string | 否 | 创建开始时间 |
| created_before | string | 否 | 创建结束时间 |

**响应参数**:
```json
{
    "code": 0,
    "data": {
        "items": [
            {
                "id": "doc_123456",
                "title": "金融数字化转型方案",
                "status": "published",
                "visibility": "internal",
                "author": {
                    "id": "user_123",
                    "username": "user@example.com",
                    "full_name": "张三"
                },
                "word_count": 3500,
                "tags": ["金融", "数字化", "转型"],
                "view_count": 156,
                "created_at": "2024-01-05T10:00:00Z",
                "updated_at": "2024-01-07T15:30:00Z"
            }
        ],
        "total": 45,
        "page": 1,
        "page_size": 20
    }
}
```

#### 3.1.2 创建文档
```http
POST /documents
```

**请求参数**:
```json
{
    "title": "金融数字化转型方案",
    "content": "# 背景\n\n随着金融科技的快速发展...",
    "content_type": "markdown",
    "template_id": "template_123",
    "tags": ["金融", "数字化", "转型"],
    "visibility": "internal",
    "custom_fields": {
        "industry": "banking",
        "budget": "1000000",
        "timeline": "12 months"
    }
}
```

**响应参数**:
```json
{
    "code": 0,
    "data": {
        "id": "doc_123456",
        "title": "金融数字化转型方案",
        "status": "draft",
        "word_count": 3500,
        "created_at": "2024-01-08T12:00:00Z",
        "author": {
            "id": "user_123",
            "full_name": "张三"
        }
    }
}
```

#### 3.1.3 获取文档详情
```http
GET /documents/{document_id}
```

**响应参数**:
```json
{
    "code": 0,
    "data": {
        "id": "doc_123456",
        "title": "金融数字化转型方案",
        "content": "# 背景\n\n随着金融科技的快速发展...",
        "content_type": "markdown",
        "status": "published",
        "visibility": "internal",
        "version": 3,
        "word_count": 3500,
        "tags": ["金融", "数字化", "转型"],
        "author": {
            "id": "user_123",
            "username": "user@example.com",
            "full_name": "张三",
            "department": "技术部"
        },
        "template": {
            "id": "template_123",
            "name": "数字化转型模板",
            "category": "金融"
        },
        "custom_fields": {
            "industry": "banking",
            "budget": "1000000",
            "timeline": "12 months"
        },
        "statistics": {
            "view_count": 156,
            "download_count": 23,
            "like_count": 12
        },
        "permissions": {
            "can_read": true,
            "can_write": true,
            "can_delete": false
        },
        "created_at": "2024-01-05T10:00:00Z",
        "updated_at": "2024-01-07T15:30:00Z",
        "published_at": "2024-01-07T16:00:00Z"
    }
}
```

#### 3.1.4 更新文档
```http
PUT /documents/{document_id}
```

**请求参数**:
```json
{
    "title": "金融数字化转型方案（修订版）",
    "content": "# 背景\n\n随着金融科技的快速发展...\n\n## 更新内容...",
    "tags": ["金融", "数字化", "转型", "2024"],
    "custom_fields": {
        "industry": "banking",
        "budget": "1200000",
        "timeline": "18 months",
        "status": "in_progress"
    }
}
```

#### 3.1.5 删除文档
```http
DELETE /documents/{document_id}
```

**响应参数**:
```json
{
    "code": 0,
    "message": "Document deleted successfully"
}
```

### 3.2 文档协作

#### 3.2.1 获取文档版本历史
```http
GET /documents/{document_id}/versions
```

**响应参数**:
```json
{
    "code": 0,
    "data": {
        "items": [
            {
                "id": "version_3",
                "version_number": 3,
                "title": "金融数字化转型方案（修订版）",
                "change_summary": "更新了预算和时间线",
                "change_type": "content",
                "created_by": {
                    "id": "user_123",
                    "full_name": "张三"
                },
                "created_at": "2024-01-07T15:30:00Z",
                "is_current": true
            }
        ],
        "total": 3
    }
}
```

#### 3.2.2 文档评论
```http
POST /documents/{document_id}/comments
```

**请求参数**:
```json
{
    "content": "这个方案很好，建议增加风险评估部分",
    "position": {
        "start_line": 15,
        "end_line": 18,
        "start_char": 0,
        "end_char": 50
    },
    "parent_id": null
}
```

#### 3.2.3 文档分享
```http
POST /documents/{document_id}/share
```

**请求参数**:
```json
{
    "share_type": "link",
    "permissions": ["read"],
    "expires_at": "2024-02-08T00:00:00Z",
    "password": "share123"
}
```

**响应参数**:
```json
{
    "code": 0,
    "data": {
        "share_id": "share_123",
        "share_link": "https://app.fin-pre-assist.com/shared/doc_123456?token=abc123",
        "qr_code": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAA...",
        "expires_at": "2024-02-08T00:00:00Z"
    }
}
```

### 3.3 文档导出

#### 3.3.1 导出文档
```http
POST /documents/{document_id}/export
```

**请求参数**:
```json
{
    "format": "pdf",
    "options": {
        "include_header": true,
        "include_footer": true,
        "page_size": "A4",
        "orientation": "portrait",
        "margin": {
            "top": "1in",
            "bottom": "1in",
            "left": "1in",
            "right": "1in"
        }
    }
}
```

**响应参数**:
```json
{
    "code": 0,
    "data": {
        "export_id": "export_123",
        "status": "processing",
        "progress": 0,
        "estimated_time": 30
    }
}
```

#### 3.3.2 获取导出状态
```http
GET /documents/{document_id}/export/{export_id}
```

**响应参数**:
```json
{
    "code": 0,
    "data": {
        "export_id": "export_123",
        "status": "completed",
        "progress": 100,
        "file_url": "https://storage.fin-pre-assist.com/exports/export_123.pdf",
        "file_size": 2048576,
        "expires_at": "2024-01-09T12:00:00Z"
    }
}
```

## 4. 知识库接口

### 4.1 知识条目管理

#### 4.1.1 获取知识条目列表
```http
GET /knowledge?page=1&page_size=20&category=technology&search=人工智能
```

**响应参数**:
```json
{
    "code": 0,
    "data": {
        "items": [
            {
                "id": "knowledge_123",
                "title": "人工智能在银行业的应用",
                "content": "人工智能技术在银行业的应用越来越广泛...",
                "category": "technology",
                "tags": ["AI", "银行", "金融科技"],
                "author": {
                    "id": "user_456",
                    "full_name": "李四"
                },
                "quality_score": 4.5,
                "reliability_score": 0.92,
                "view_count": 234,
                "use_count": 45,
                "created_at": "2024-01-03T14:20:00Z"
            }
        ],
        "total": 156
    }
}
```

#### 4.1.2 创建知识条目
```http
POST /knowledge
```

**请求参数**:
```json
{
    "title": "区块链技术在供应链金融中的应用",
    "content": "区块链技术通过其去中心化、不可篡改的特性...",
    "category": "technology",
    "subcategory": "blockchain",
    "tags": ["区块链", "供应链金融", "去中心化"],
    "source": "内部研究",
    "source_url": "https://internal.research.com/blockchain-supply-chain"
}
```

#### 4.1.3 知识条目语义搜索
```http
POST /knowledge/search
```

**请求参数**:
```json
{
    "query": "数字化转型对银行业的影响",
    "search_type": "semantic",
    "filters": {
        "category": "technology",
        "min_quality_score": 4.0
    },
    "top_k": 10
}
```

**响应参数**:
```json
{
    "code": 0,
    "data": {
        "results": [
            {
                "id": "knowledge_789",
                "title": "银行业数字化转型趋势分析",
                "content": "数字化转型正在重塑银行业...",
                "score": 0.89,
                "category": "technology",
                "quality_score": 4.2,
                "author": {
                    "id": "user_789",
                    "full_name": "王五"
                }
            }
        ],
        "total": 5,
        "search_time": 0.234
    }
}
```

### 4.2 知识图谱

#### 4.2.1 获取知识关联
```http
GET /knowledge/{knowledge_id}/relations
```

**响应参数**:
```json
{
    "code": 0,
    "data": {
        "nodes": [
            {
                "id": "knowledge_123",
                "title": "人工智能在银行业的应用",
                "category": "technology",
                "score": 4.5
            }
        ],
        "edges": [
            {
                "source": "knowledge_123",
                "target": "knowledge_456",
                "relation_type": "similar",
                "weight": 0.85
            }
        ]
    }
}
```

#### 4.2.2 知识推荐
```http
GET /knowledge/recommendations?context=document&context_id=doc_123&limit=5
```

## 5. 模板管理接口

### 5.1 模板操作

#### 5.1.1 获取模板列表
```http
GET /templates?page=1&page_size=20&category=finance&industry=banking&is_official=true
```

**响应参数**:
```json
{
    "code": 0,
    "data": {
        "items": [
            {
                "id": "template_123",
                "name": "银行数字化转型方案模板",
                "description": "适用于银行业的数字化转型方案模板",
                "category": "finance",
                "industry": "banking",
                "is_official": true,
                "rating": 4.6,
                "usage_count": 234,
                "author": {
                    "id": "user_456",
                    "full_name": "李四"
                },
                "tags": ["银行", "数字化", "转型"],
                "created_at": "2023-12-15T09:00:00Z"
            }
        ],
        "total": 89
    }
}
```

#### 5.1.2 获取模板详情
```http
GET /templates/{template_id}
```

**响应参数**:
```json
{
    "code": 0,
    "data": {
        "id": "template_123",
        "name": "银行数字化转型方案模板",
        "description": "适用于银行业的数字化转型方案模板",
        "content": "# 执行摘要\n\n{执行摘要内容}\n\n# 项目背景\n\n{项目背景内容}\n\n# 解决方案\n\n{解决方案内容}",
        "category": "finance",
        "subcategory": "digital_transformation",
        "industry": "banking",
        "template_type": "document",
        "required_fields": ["executive_summary", "background", "solution"],
        "validation_rules": {
            "executive_summary": {
                "min_length": 200,
                "max_length": 1000
            }
        },
        "author": {
            "id": "user_456",
            "full_name": "李四"
        },
        "rating": 4.6,
        "rating_count": 45,
        "usage_count": 234,
        "quality_score": 0.92,
        "is_official": true,
        "is_public": true,
        "version": 2,
        "tags": ["银行", "数字化", "转型"],
        "created_at": "2023-12-15T09:00:00Z",
        "updated_at": "2024-01-05T14:20:00Z"
    }
}
```

#### 5.1.3 使用模板创建文档
```http
POST /templates/{template_id}/use
```

**请求参数**:
```json
{
    "title": "XX银行数字化转型方案",
    "fields": {
        "executive_summary": "本方案旨在帮助XX银行实现全面数字化转型...",
        "background": "随着金融科技的快速发展，传统银行面临巨大挑战...",
        "solution": "我们建议采用分阶段实施的数字化转型策略..."
    },
    "custom_content": "\n# 实施计划\n\n详细的项目实施计划..."
}
```

**响应参数**:
```json
{
    "code": 0,
    "data": {
        "document_id": "doc_789",
        "title": "XX银行数字化转型方案",
        "status": "draft",
        "word_count": 2847,
        "created_at": "2024-01-08T12:30:00Z"
    }
}
```

### 5.2 模板评价

#### 5.2.1 评价模板
```http
POST /templates/{template_id}/ratings
```

**请求参数**:
```json
{
    "rating": 4.5,
    "review": "这个模板非常实用，结构清晰，覆盖了银行数字化转型的关键要点。",
    "aspects": {
        "completeness": 5,
        "clarity": 4,
        "practicality": 4,
        "innovation": 4
    }
}
```

#### 5.2.2 获取模板评价
```http
GET /templates/{template_id}/ratings?page=1&page_size=10
```

## 6. AI服务接口

### 6.1 内容生成

#### 6.1.1 AI方案生成
```http
POST /ai/generate/document
```

**请求参数**:
```json
{
    "prompt": "为某商业银行设计一份数字化转型方案",
    "context": {
        "industry": "banking",
        "company_size": "large",
        "budget_range": "1-5M",
        "timeline": "12-18 months",
        "key_requirements": ["提升客户体验", "降低运营成本", "增强风控能力"]
    },
    "options": {
        "tone": "professional",
        "length": "comprehensive",
        "language": "zh-CN",
        "include_examples": true,
        "creativity_level": 0.7
    }
}
```

**响应参数**:
```json
{
    "code": 0,
    "data": {
        "generation_id": "gen_123",
        "status": "processing",
        "estimated_time": 45,
        "progress": 0
    }
}
```

#### 6.1.2 获取生成状态
```http
GET /ai/generate/{generation_id}/status
```

**响应参数**:
```json
{
    "code": 0,
    "data": {
        "generation_id": "gen_123",
        "status": "completed",
        "progress": 100,
        "result": {
            "title": "商业银行数字化转型整体解决方案",
            "content": "# 执行摘要\n\n随着金融科技的快速发展，商业银行面临着前所未有的数字化转型压力...",
            "sections": [
                {
                    "title": "执行摘要",
                    "content": "详细内容..."
                },
                {
                    "title": "项目背景",
                    "content": "详细内容..."
                }
            ],
            "word_count": 2847,
            "confidence_score": 0.89,
            "suggestions": [
                "建议增加具体的实施时间表",
                "建议补充预算分配的详细说明"
            ]
        },
        "created_at": "2024-01-08T12:00:00Z",
        "completed_at": "2024-01-08T12:00:45Z"
    }
}
```

### 6.2 内容优化

#### 6.2.1 文本优化
```http
POST /ai/optimize/text
```

**请求参数**:
```json
{
    "text": "我们的解决方案可以帮助银行提高效率，降低成本，提升客户满意度。",
    "optimization_type": "professional",
    "context": {
        "document_type": "proposal",
        "industry": "banking",
        "target_audience": "executives"
    }
}
```

**响应参数**:
```json
{
    "code": 0,
    "data": {
        "original_text": "我们的解决方案可以帮助银行提高效率，降低成本，提升客户满意度。",
        "optimized_text": "本解决方案通过整合先进的金融科技能力，助力银行业机构实现运营效率的显著提升、运营成本的系统性优化，以及客户满意度的全方位增强。",
        "changes": [
            {
                "type": "vocabulary",
                "original": "帮助",
                "optimized": "助力",
                "reason": "使用更专业的商业术语"
            }
        ],
        "improvements": {
            "professionalism": 0.8,
            "clarity": 0.9,
            "impact": 0.85
        }
    }
}
```

#### 6.2.2 内容续写
```http
POST /ai/continue/text
```

**请求参数**:
```json
{
    "text": "随着数字化转型的深入推进，银行业面临着前所未有的机遇和挑战。",
    "context": "银行数字化转型方案的执行摘要部分",
    "length": "medium",
    "tone": "professional",
    "style": "analytical"
}
```

### 6.3 智能推荐

#### 6.3.1 相关文档推荐
```http
GET /ai/recommendations/documents?document_id=doc_123&limit=5
```

**响应参数**:
```json
{
    "code": 0,
    "data": {
        "recommendations": [
            {
                "id": "doc_456",
                "title": "金融科技发展趋势报告",
                "relevance_score": 0.92,
                "reason": "内容主题相似，涉及相同的金融科技领域",
                "author": {
                    "id": "user_789",
                    "full_name": "王五"
                },
                "view_count": 234
            }
        ]
    }
}
```

#### 6.3.2 知识推荐
```http
GET /ai/recommendations/knowledge?context=writing&query=数字化转型&limit=5
```

## 7. 系统管理接口

### 7.1 系统配置

#### 7.1.1 获取系统配置
```http
GET /admin/config
```

**响应参数**:
```json
{
    "code": 0,
    "data": {
        "general": {
            "site_name": "金融售前方案辅助编写系统",
            "site_description": "专业的金融售前方案编写平台",
            "contact_email": "support@fin-pre-assist.com"
        },
        "security": {
            "password_min_length": 8,
            "password_complexity_required": true,
            "max_login_attempts": 5,
            "session_timeout": 3600
        },
        "ai": {
            "generation_timeout": 60,
            "max_tokens_per_request": 4000,
            "daily_quota_per_user": 100
        },
        "storage": {
            "max_file_size": 10485760,
            "allowed_file_types": ["pdf", "docx", "xlsx", "pptx", "jpg", "png"]
        }
    }
}
```

#### 7.1.2 更新系统配置
```http
PUT /admin/config
```

### 7.2 系统监控

#### 7.2.1 获取系统状态
```http
GET /admin/system/status
```

**响应参数**:
```json
{
    "code": 0,
    "data": {
        "status": "healthy",
        "timestamp": "2024-01-08T12:00:00Z",
        "uptime": 86400,
        "components": {
            "database": {
                "status": "healthy",
                "latency": 0.015,
                "connections": {
                    "active": 45,
                    "idle": 12,
                    "total": 57
                }
            },
            "redis": {
                "status": "healthy",
                "latency": 0.002,
                "memory_usage": "1.2GB",
                "hit_rate": 0.95
            },
            "ai_service": {
                "status": "healthy",
                "queue_size": 3,
                "processing_rate": 2.5
            }
        },
        "metrics": {
            "total_users": 1250,
            "active_users": 234,
            "total_documents": 4567,
            "documents_today": 23
        }
    }
}
```

#### 7.2.2 获取系统日志
```http
GET /admin/system/logs?level=error&start_time=2024-01-08T00:00:00Z&end_time=2024-01-08T23:59:59Z&limit=100
```

**响应参数**:
```json
{
    "code": 0,
    "data": {
        "items": [
            {
                "id": "log_123",
                "timestamp": "2024-01-08T10:30:00Z",
                "level": "error",
                "logger": "document_service",
                "message": "Failed to process document",
                "details": {
                    "document_id": "doc_456",
                    "error": "Template not found",
                    "stack_trace": "..."
                },
                "user_id": "user_789",
                "ip_address": "192.168.1.100",
                "user_agent": "Mozilla/5.0..."
            }
        ],
        "total": 45
    }
}
```

### 7.3 用户管理

#### 7.3.1 批量操作用户
```http
POST /admin/users/bulk
```

**请求参数**:
```json
{
    "action": "update_role",
    "user_ids": ["user_123", "user_456", "user_789"],
    "parameters": {
        "new_role": "editor"
    }
}
```

#### 7.3.2 导出用户数据
```http
POST /admin/users/export
```

**请求参数**:
```json
{
    "format": "csv",
    "filters": {
        "role": "editor",
        "status": "active",
        "created_after": "2023-01-01"
    },
    "fields": ["id", "username", "full_name", "email", "role", "created_at"]
}
```

## 8. WebSocket接口

### 8.1 实时协作

#### 8.1.1 连接WebSocket
```javascript
const ws = new WebSocket('wss://api.fin-pre-assist.com/ws');

// 认证
ws.send(JSON.stringify({
    type: 'auth',
    token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...'
}));
```

#### 8.1.2 加入文档协作
```javascript
// 加入文档房间
ws.send(JSON.stringify({
    type: 'join_document',
    document_id: 'doc_123456'
}));
```

#### 8.1.3 发送编辑操作
```javascript
// 发送编辑操作
ws.send(JSON.stringify({
    type: 'edit_operation',
    document_id: 'doc_123456',
    operation: {
        type: 'insert',
        position: 1234,
        content: '新增内容',
        author_id: 'user_123'
    }
}));
```

#### 8.1.4 接收实时更新
```javascript
// 接收实时更新
ws.onmessage = function(event) {
    const message = JSON.parse(event.data);

    switch(message.type) {
        case 'user_joined':
            console.log(`用户 ${message.user.full_name} 加入了协作`);
            break;
        case 'edit_operation':
            applyEditOperation(message.operation);
            break;
        case 'cursor_position':
            updateCursorPosition(message.user_id, message.position);
            break;
        case 'user_typing':
            showUserTyping(message.user_id, message.is_typing);
            break;
    }
};
```

### 8.2 通知推送

#### 8.2.1 接收通知
```javascript
// 接收系统通知
ws.onmessage = function(event) {
    const message = JSON.parse(event.data);

    if (message.type === 'notification') {
        showNotification({
            id: message.notification.id,
            type: message.notification.type,
            title: message.notification.title,
            content: message.notification.content,
            timestamp: message.notification.timestamp
        });
    }
};
```

#### 8.2.2 通知类型
| 类型 | 说明 |
|------|------|
| document_shared | 文档被分享 |
| document_commented | 文档被评论 |
| ai_generation_completed | AI生成完成 |
| system_announcement | 系统公告 |
| user_mentioned | 用户被提及 |

## 9. 文件上传接口

### 9.1 上传文件

#### 9.1.1 获取上传凭证
```http
POST /files/upload/token
```

**请求参数**:
```json
{
    "file_name": "proposal.pdf",
    "file_size": 5242880,
    "file_type": "application/pdf",
    "purpose": "document_attachment"
}
```

**响应参数**:
```json
{
    "code": 0,
    "data": {
        "upload_token": "upload_token_123",
        "upload_url": "https://storage.fin-pre-assist.com/upload",
        "expires_at": "2024-01-08T13:00:00Z",
        "max_chunk_size": 1048576,
        "supported_formats": ["pdf", "docx", "xlsx", "pptx", "jpg", "png"]
    }
}
```

#### 9.1.2 分片上传
```http
POST {upload_url}
```

**请求参数**:
```http
Content-Type: multipart/form-data

file: [二进制文件数据]
upload_token: upload_token_123
chunk_index: 0
total_chunks: 5
file_name: proposal.pdf
```

#### 9.1.3 完成上传
```http
POST /files/upload/complete
```

**请求参数**:
```json
{
    "upload_token": "upload_token_123",
    "chunks": [
        {"index": 0, "etag": "etag_1"},
        {"index": 1, "etag": "etag_2"},
        {"index": 2, "etag": "etag_3"},
        {"index": 3, "etag": "etag_4"},
        {"index": 4, "etag": "etag_5"}
    ]
}
```

**响应参数**:
```json
{
    "code": 0,
    "data": {
        "file_id": "file_123",
        "file_url": "https://storage.fin-pre-assist.com/files/file_123.pdf",
        "file_size": 5242880,
        "file_type": "application/pdf",
        "expires_at": "2025-01-08T12:00:00Z"
    }
}
```

### 9.2 文件管理

#### 9.2.1 获取文件信息
```http
GET /files/{file_id}
```

#### 9.2.2 删除文件
```http
DELETE /files/{file_id}
```

## 10. 错误处理

### 10.1 错误码定义

#### 10.1.1 认证错误
| 错误码 | 说明 |
|--------|------|
| 40101 | 用户名或密码错误 |
| 40102 | 账户被锁定 |
| 40103 | 需要验证码 |
| 40104 | Token已过期 |
| 40105 | Token无效 |
| 40106 | 权限不足 |

#### 10.1.2 业务错误
| 错误码 | 说明 |
|--------|------|
| 42201 | 文档不存在 |
| 42202 | 模板不存在 |
| 42203 | 知识条目不存在 |
| 42204 | 用户配额不足 |
| 42205 | 文件格式不支持 |
| 42206 | 文件大小超限 |
| 42207 | 内容包含敏感信息 |

#### 10.1.3 系统错误
| 错误码 | 说明 |
|--------|------|
| 50001 | 数据库连接失败 |
| 50002 | AI服务不可用 |
| 50003 | 文件存储失败 |
| 50004 | 邮件发送失败 |
| 50005 | 缓存服务异常 |

### 10.2 错误处理示例

#### 10.2.1 参数验证错误
```json
{
    "code": 40001,
    "message": "Parameter validation failed",
    "details": {
        "errors": [
            {
                "field": "email",
                "message": "Invalid email format",
                "value": "invalid-email"
            },
            {
                "field": "password",
                "message": "Password must be at least 8 characters",
                "value": "123"
            }
        ]
    },
    "timestamp": "2024-01-08T12:00:00Z"
}
```

#### 10.2.2 业务逻辑错误
```json
{
    "code": 42204,
    "message": "User quota exceeded",
    "details": {
        "quota_type": "document_creation",
        "current_usage": 100,
        "quota_limit": 100,
        "resets_at": "2024-02-01T00:00:00Z"
    },
    "timestamp": "2024-01-08T12:00:00Z"
}
```

#### 10.2.3 系统错误
```json
{
    "code": 50002,
    "message": "AI service temporarily unavailable",
    "details": {
        "service": "ai_generation",
        "retry_after": 60,
        "incident_id": "incident_123"
    },
    "timestamp": "2024-01-08T12:00:00Z"
}
```

## 11. 限流与配额

### 11.1 限流规则

#### 11.1.1 API限流
| 接口类型 | 频率限制 | 说明 |
|----------|----------|------|
| 认证接口 | 10次/分钟 | 防止暴力破解 |
| 文档创建 | 20次/小时 | 防止滥用 |
| AI生成 | 50次/天 | 按用户配额 |
| 文件上传 | 100次/天 | 大文件限制 |
| 搜索接口 | 100次/分钟 | 正常搜索需求 |

#### 11.1.2 配额管理
| 用户角色 | 文档配额 | AI配额 | 存储配额 |
|----------|----------|--------|----------|
| 免费用户 | 10个/月 | 20次/天 | 100MB |
| 基础用户 | 100个/月 | 100次/天 | 1GB |
| 专业用户 | 无限制 | 500次/天 | 10GB |
| 企业用户 | 无限制 | 2000次/天 | 100GB |

### 11.2 配额查询

#### 11.2.1 获取用户配额
```http
GET /users/quota
```

**响应参数**:
```json
{
    "code": 0,
    "data": {
        "document_quota": {
            "total": 100,
            "used": 45,
            "remaining": 55,
            "resets_at": "2024-02-01T00:00:00Z"
        },
        "ai_quota": {
            "total": 500,
            "used": 234,
            "remaining": 266,
            "resets_at": "2024-01-09T00:00:00Z"
        },
        "storage_quota": {
            "total": 10737418240,
            "used": 3456789012,
            "remaining": 7280629228,
            "percentage": 32.2
        }
    }
}
```

## 12. SDK与工具

### 12.1 JavaScript SDK

#### 12.1.1 安装SDK
```bash
npm install fin-pre-assist-sdk
```

#### 12.1.2 使用示例
```javascript
import FinPreAssist from 'fin-pre-assist-sdk';

// 初始化客户端
const client = new FinPreAssist({
    baseURL: 'https://api.fin-pre-assist.com/v1',
    apiKey: 'your-api-key',
    timeout: 30000
});

// 用户登录
async function login() {
    try {
        const result = await client.auth.login({
            username: 'user@example.com',
            password: 'password123'
        });

        console.log('Login successful:', result.data);
        return result.data.access_token;
    } catch (error) {
        console.error('Login failed:', error.message);
        throw error;
    }
}

// 创建文档
async function createDocument(token) {
    try {
        const result = await client.documents.create({
            title: '测试文档',
            content: '# 测试内容',
            tags: ['测试']
        }, {
            headers: {
                'Authorization': `Bearer ${token}`
            }
        });

        console.log('Document created:', result.data);
        return result.data;
    } catch (error) {
        console.error('Failed to create document:', error.message);
        throw error;
    }
}

// 使用AI生成内容
async function generateContent(token) {
    try {
        const result = await client.ai.generateDocument({
            prompt: '为某银行设计数字化转型方案',
            context: {
                industry: 'banking',
                company_size: 'large'
            }
        }, {
            headers: {
                'Authorization': `Bearer ${token}`
            }
        });

        console.log('Generation started:', result.data);

        // 轮询获取结果
        const generationId = result.data.generation_id;
        let generationResult;

        do {
            await new Promise(resolve => setTimeout(resolve, 2000));
            generationResult = await client.ai.getGenerationStatus(generationId, {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });
        } while (generationResult.data.status === 'processing');

        return generationResult.data;
    } catch (error) {
        console.error('AI generation failed:', error.message);
        throw error;
    }
}
```

### 12.2 Python SDK

#### 12.2.1 安装SDK
```bash
pip install fin-pre-assist-sdk
```

#### 12.2.2 使用示例
```python
from fin_pre_assist import FinPreAssistClient
import asyncio

# 创建客户端
client = FinPreAssistClient(
    base_url='https://api.fin-pre-assist.com/v1',
    api_key='your-api-key',
    timeout=30
)

async def main():
    # 用户登录
    try:
        login_result = await client.auth.login(
            username='user@example.com',
            password='password123'
        )
        token = login_result['data']['access_token']
        print(f"Login successful. Token: {token[:20]}...")

        # 获取文档列表
        documents = await client.documents.list(
            page=1,
            page_size=10,
            status='published',
            headers={'Authorization': f'Bearer {token}'}
        )
        print(f"Found {documents['data']['total']} documents")

        # AI生成文档
        generation = await client.ai.generate_document(
            prompt='生成一份金融科技趋势分析报告',
            context={'industry': 'fintech'},
            headers={'Authorization': f'Bearer {token}'}
        )

        generation_id = generation['data']['generation_id']
        print(f"AI generation started: {generation_id}")

        # 等待生成完成
        while True:
            status = await client.ai.get_generation_status(
                generation_id,
                headers={'Authorization': f'Bearer {token}'}
            )

            if status['data']['status'] == 'completed':
                result = status['data']['result']
                print(f"Generation completed: {result['title']}")
                print(f"Word count: {result['word_count']}")
                break
            elif status['data']['status'] == 'failed':
                print(f"Generation failed")
                break

            await asyncio.sleep(2)

    except Exception as e:
        print(f"Error: {e}")

if __name__ == "__main__":
    asyncio.run(main())
```

## 13. 测试环境

### 13.1 测试服务器
- **地址**: `https://api-test.fin-pre-assist.com/v1`
- **状态**: 24小时运行
- **数据**: 每日重置

### 13.2 测试账号
| 角色 | 用户名 | 密码 |
|------|--------|------|
| 管理员 | admin@example.com | Test123456 |
| 编辑者 | editor@example.com | Test123456 |
| 查看者 | viewer@example.com | Test123456 |

### 13.3 测试数据
- 文档数据：1000+ 测试文档
- 模板数据：200+ 测试模板
- 知识库：500+ 知识条目

## 14. 更新日志

### 14.1 v1.2.0 (2025-01-08)
- 新增WebSocket实时协作接口
- 优化AI生成接口性能
- 增加批量操作接口
- 完善错误处理机制

### 14.2 v1.1.0 (2024-12-15)
- 新增AI服务相关接口
- 增加知识图谱接口
- 优化搜索接口性能
- 增加文件上传接口

### 14.3 v1.0.0 (2024-12-01)
- 初始版本发布
- 包含用户、文档、模板、知识库核心接口
- 支持基本的CRUD操作
- 实现JWT认证机制

---

**文档结束**

*本API接口文档为金融售前方案辅助编写系统提供了完整的接口规范，包括请求参数、响应格式、错误处理等详细信息，便于开发者快速集成和使用。*